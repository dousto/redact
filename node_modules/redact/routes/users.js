var express = require('express');
var router = express.Router();
//var asp = require('../lib/asp');
var path = require('path');
var clingo = require('../lib/clingo');

/* GET users listing. */
router.get('/', function(req, res) {
//    var clingo = new asp.Clingo();

    res.type('json');
    res.write('[');
    var prevAnswer;
//    clingo.compute({
//        lpFiles:path.resolve(__dirname, '../lib/lp/rhythm.lp'),
//        withAtoms: ['play(0)', 'play(1)'],
//        varMap:{"from": 0, "to": 1}
//    })
//        .on('answer', function(answer) {
//            if (prevAnswer) res.write(JSON.stringify(prevAnswer) + ',');
//            prevAnswer = answer;
////            var i = 3 * 279
//        })
//        .on('answers', function(answers) {
//            if (prevAnswer) res.write(JSON.stringify(prevAnswer));
//            res.write(']');
//            res.send();
//        });

    clingo.config({ inputFiles: [path.resolve(__dirname, '../lib/lp/rhythm.lp')] }).solve({
        constants: {from: 0, to: 2}, maxModels: 0
    })
        .on('model', function(answer) {
            if (prevAnswer) res.write(JSON.stringify(prevAnswer) + ',');
            prevAnswer = answer;
        })
        .on('end', function () {
            if (prevAnswer) res.write(JSON.stringify(prevAnswer));
            res.write(']');
            res.send();
        });
});

module.exports = router;
